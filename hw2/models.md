# Ranking Algorithms

## Ranknet

Дан датасет из триплетов (запрос, ответ, мера релевантости), где мера релевантности $\in\{0,1,2\}$. Нужно посчитать лямбды для каждого ответа

Основная формула:
$$
\lambda_{ij}={-\alpha\over1+\exp(\alpha(s_i-s_j))}
$$

1. Сгруппировать все записи по запросам

2. Для каждого запроса сгруппировать все ответы по мере релевантности: $Y_0,Y_1,Y_2$

   3. $\forall i\in Y_2$

      1. сформировать $A=\{(i,j):i\in Y_2,\ j\in Y_0\cup Y_1\}$

      2. сосчитать $\lambda_i=\sum_{j:\ (i,j)\in A}\lambda_{ij}$

   4. $\forall j\in Y_1$
      1. сформировать $B=\{(j,k):j\in Y_1,\ k\in Y_0\}$
      2. сосчитать $\lambda_j=-\sum_{i:\ (i,j)\in A}\lambda_{ij}+\sum_{k:\ (j,k)\in B}\lambda_{jk}$

   5. $\forall k\in Y_0$
      1. сосчитать $\lambda_k=-\sum_{i:\ (i,k)\in A}\lambda_{ik}-\sum_{j:\ (j,k)\in B}\lambda_{jk}$

   6. Убрать градиенты со всех лямбд
   7. Вектор всех скоров $s$ умножить на вектор всех лямбд $\lambda$: $C=\lambda\circ s$
   8. Просуммировать все компоненты $C$
   9. Посчитать градиенты и сделать шаг оптимизации

